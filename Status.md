# Researching previous work

- [KDE TechBase: Languages/Perl](https://techbase.kde.org/Languages/Perl)
- [Google Code archive, August 10, 2010: perlqt4](https://code.google.com/archive/p/perlqt4/)
- [2003, PerlQt version 3, PerlQt Project](http://perlqt.sourceforge.net/)

# State of SMOKE bindings to Qt

- The code in [chrisburel/perlqt](https://github.com/chrisburel/perlqt) seems to depend
  on SMOKE binding generated by [chrisburel/smokegen](https://github.com/chrisburel/smokegen) which seems to be abandoned in September 2019. It looks like it was trying to use Clang tooling libraries to port SMOKE bindings from Qt4 to Qt5, but maybe it became too complicated to do that? Or something else stopped the development. There are signs (see below) that most language bining to Qt are having trouble with SMOKE and Qt5 and they are trying to find alternative solutions.

- However, [mcristg/smokegen](https://github.com/mcristg/smokegen) seems to have been able to port smokegen to Qt5 for Common Lisp's [CommonQt5](https://github.com/commonqt/commonqt5), see also [CommonQt](https://commonqt.common-lisp.dev/) and [Shinmera/qtools](https://github.com/Shinmera/qtools)

- Still CommonQt might drop SMOKE support in the future, see [The qt-libs Reference Manual](https://quickref.common-lisp.net/qt-libs.html#Introduction) :

> In the future, CommonQt will use its own system to hook into Qt and drop Smoke support. When that time comes, this project will hopefully become obsolete. However, for the time being, Smoke is a necessary evil, and as such, this library hopes to make things a bit easier.

- There is a currently an effort going on to build [Shinmera/qt-libs](https://github.com/Shinmera/qt-libs) with Qt5, see [this](https://github.com/commonqt/commonqt5/issues/2) issue. More information about qt-libs can be found [here](https://shinmera.github.io/qt-libs/).

# Compiling smokegen from mcrist/smokegen

- Refer to [mcristg/smokegen](https://github.com/mcristg/smokegen) and [commonqt/smokegen](https://github.com/commonqt/smokegen)

## Building commonqt/smokegen

```
$ sudo apt-get install libclang-11-dev libclang-13-dev llvm-11-dev llvm-13-dev
$ g++ --version | head -1
g++ (Ubuntu 11.2.0-7ubuntu2) 11.2.0
$ clang --version
Ubuntu clang version 13.0.0-2
Target: x86_64-pc-linux-gnu
Thread model: posix
InstalledDir: /bin
$ lsb_release -a
No LSB modules are available.
Distributor ID:	Ubuntu
Description:	Ubuntu 21.10
Release:	21.10
Codename:	impish
$ git clone -b v5.14.2 git@github.com:qt/qtbase.git
$ git switch -c v5.14.2
$ cat configure.patch
```

```patch
diff --git a/src/corelib/global/qfloat16.h b/src/corelib/global/qfloat16.h
index 02fd2f03cc..1bde205c92 100644
--- a/src/corelib/global/qfloat16.h
+++ b/src/corelib/global/qfloat16.h
@@ -44,6 +44,7 @@
 #include <QtCore/qglobal.h>
 #include <QtCore/qmetatype.h>
 #include <string.h>
+#include <limits>

 #if defined(QT_COMPILER_SUPPORTS_F16C) && defined(__AVX2__) && !defined(__F16C__)
 // All processors that support AVX2 do support F16C too. That doesn't mean
diff --git a/src/corelib/text/qbytearraymatcher.h b/src/corelib/text/qbytearraymatcher.h
index 0eedfc1d20..ee415e336d 100644
--- a/src/corelib/text/qbytearraymatcher.h
+++ b/src/corelib/text/qbytearraymatcher.h
@@ -41,6 +41,7 @@
 #define QBYTEARRAYMATCHER_H

 #include <QtCore/qbytearray.h>
+#include <limits>

 QT_BEGIN_NAMESPACE
```

```
$ git apply configure.patch
$ ./configure -prefix /opt/qt/qtbase -opensource -release -nomake tests -nomake examples -c++std c++14 -no-dbus -prefix /opt/qt/qtbase
$ make
$ make install
```

# About SMOKE (it seems it does not support Qt5)

- [KDE TechBase: Languages/Smoke](https://techbase.kde.org/Languages/Smoke)

- [time to retire some kde4/smoke-based language bindings?](https://devel.fedoraproject.narkive.com/wcw8K9x3/time-to-retire-some-kde4-smoke-based-language-bindings)

- [Ruby bindings to Qt: development of the upstream qtruby/smoke has ended](https://github.com/ryanmelt/qtbindings/issues/131)

- [Ruby binding to Qt: project is no longer maintained](https://github.com/ryanmelt/qtbindings): Quote:
  *"It only supports Qt4 which the latest linux distributions no longer
  include in their package repos. No future releases or changes are
  planned. If you would like to take over, please fork, and make the
  changes to support Qt5/Qt6. This will be really difficult as the
  Smoke libraries used in this project do not work well with C++11+"*

# clang tooling (used by smokegen)
- [How To Setup Clang Tooling For LLVM](https://clang.llvm.org/docs/HowToSetupToolingForLLVM.html)

# Compiling smokegen from chrisburel/smokegen

- Refer to [chrisburel/smokegen](https://github.com/chrisburel/smokegen)
- Current compile error:
```
$ cmake -DCMAKE_INSTALL_PREFIX=/opt/perlqt -DCMAKE_C_COMPILER=clang -DCMAKE_CXX_COMPILER=clang++ ..
$ make -j12
Scanning dependencies of target smokegen
[  9%] Built target smokebase
[ 27%] Built target smokeapi
[ 27%] Built target smokedeptool
[ 36%] Building CXX object CMakeFiles/smokegen.dir/frontendaction.cpp.o
[ 36%] Building CXX object CMakeFiles/smokegen.dir/astvisitor.cpp.o
[ 40%] Building CXX object CMakeFiles/smokegen.dir/main.cpp.o
/home/hakon/test/smokegen/astvisitor.cpp:484:96: error: no matching member function for call to 'toString'
                            tempArgType.setName(QString::fromStdString(args[i].getAsIntegral().toString(10)));
                                                                       ~~~~~~~~~~~~~~~~~~~~~~~~^~~~~~~~
/usr/lib/llvm-13/include/llvm/ADT/APSInt.h:82:8: note: candidate function not viable: no known conversion from 'int' to 'SmallVectorImpl<char> &' for 1st argument
  void toString(SmallVectorImpl<char> &Str, unsigned Radix = 10) const {
       ^
/usr/lib/llvm-13/include/llvm/ADT/APInt.h:1741:8: note: candidate function not viable: requires at least 3 arguments, but 1 was provided
  void toString(SmallVectorImpl<char> &Str, unsigned Radix, bool Signed,
       ^

```
